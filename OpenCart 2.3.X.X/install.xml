<?xml version="1.0" encoding="utf-8"?>
<modification>
    <name>Meest Express - Complete Integration</name>
    <code>meest_express_complete</code>
    <version>1.2.0</version>
    <author>Meest</author>
    <link>https://meest.com</link>




    <file path="admin/view/template/sale/order_list.tpl">
        <operation>
            <search><![CDATA[<td class="text-right"><a href="<?php echo $order['view']; ?>"]]></search>
            <add position="replace">
                <![CDATA[
                <td class="text-right">
                    <?php if ($order['shipping_code'] == 'meest2.warehouse' || $order['shipping_code'] == 'meest2.courier' || $order['shipping_code'] == 'meest2.postomat') { ?>
                    <div class="btn-group">
                        <button type="button"
                                  class="btn btn-danger dropdown-toggle"
                                  data-toggle="dropdown"
                                  aria-haspopup="true"
                                  aria-expanded="false"
                                  style="
                                          background-color: #EBF1FB !important;
                                          border: none !important;
                                          border-radius: 5px !important;
                                          width: 60px;
                                          height: 37px;
                                          display: inline-flex;
                                          align-items: center;
                                          justify-content: space-between;
                                          color: #0061AF !important;
                                          padding: 0 8px;
                                          cursor: pointer;
                                        ">
                            <i class="fa fa-file-o"
                               style="
                                           font-size: 16px;
                                           color: #0061AF !important;
                                           margin-left: 5px;
                                         ">
                            </i>
                            <span style="
                                      display: inline-block;
                                      width: 0;
                                      height: 0;
                                      border-left: 4px solid transparent;
                                      border-right: 4px solid transparent;
                                      border-top: 4px solid #0061AF;
                                    "></span>
                        </button>
                        <ul class="dropdown-menu">
                            <?php if (!empty($order['meest2_cn_uuid']) && $order['meest2_cn_uuid'] != 'None') { ?>
                                <li><a href="index.php?route=extension/shipping/meest2/getParcelInfo&parcel_id=<?php echo $order['meest2_cn_uuid']; ?>&token=<?php echo $token; ?>" class="dropdown-item">View Meest CN Info</a></li>
                                <li><a href="index.php?route=extension/shipping/meest2/orderUpdateForm&parcel_id=<?php echo $order['meest2_cn_uuid']; ?>&token=<?php echo $token; ?>" class="dropdown-item">Edit Meest CN</a></li>
                            <?php } else { ?>
                                <li><a href="index.php?route=extension/shipping/meest2/orderForm&order_id=<?php echo $order['order_id']; ?>&token=<?php echo $token; ?>" class="dropdown-item">Create Meest CN</a></li>
                            <?php } ?>
                        </ul>
                    </div>
                <?php } ?>
                <a href="<?php echo $order['view']; ?>"
                ]]>
            </add>
        </operation>
    </file>
    <file path="admin/controller/sale/order.php">
        <operation>
            <search><![CDATA['edit'          => $this->url->link('sale/order/edit', 'token=' . $this->session->data['token'] . '&order_id=' . $result['order_id'] . $url, true)]]></search>
            <add position="before"><![CDATA[
                'meest2_cn_uuid'=> $result['meest2_cn_uuid'],
            ]]></add>
        </operation>
    </file>
    <file path="admin/model/sale/order.php">
        <operation>
            <search><![CDATA[$sql = "SELECT o.order_id, CONCAT(o.firstname, ' ', o.lastname) AS customer, (SELECT os.name FROM " . DB_PREFIX . "order_status os WHERE os.order_status_id = o.order_status_id AND os.language_id = '" . (int)$this->config->get('config_language_id') . "') AS order_status, o.shipping_code, o.total, o.currency_code, o.currency_value, o.date_added, o.date_modified FROM `" . DB_PREFIX . "order` o";]]></search>
            <add position="replace"><![CDATA[
$meest2_extra = '';
$check = $this->db->query("SHOW COLUMNS FROM `" . DB_PREFIX . "order` LIKE 'meest2_cn_uuid'");
if ($check && $check->num_rows) {
    $meest2_extra = ", IFNULL(o.meest2_cn_uuid, '') AS meest2_cn_uuid";
}
$sql = "SELECT o.order_id" . $meest2_extra . ", CONCAT(o.firstname, ' ', o.lastname) AS customer, (SELECT os.name FROM " . DB_PREFIX . "order_status os WHERE os.order_status_id = o.order_status_id AND os.language_id = '" . (int)$this->config->get('config_language_id') . "') AS order_status, o.shipping_code, o.total, o.currency_code, o.currency_value, o.date_added, o.date_modified FROM `" . DB_PREFIX . "order` o";
        ]]></add>
        </operation>
    </file>

    <file path="admin/view/template/sale/order_list.tpl">
        <operation>
            <search><![CDATA[<button type="submit" id="button-shipping" form="form-order" formaction="<?php echo $shipping; ?>"]]></search>
            <add position="before">
                <![CDATA[
               		<div class="btn-group">
                          <button type="button"
                                  class="btn btn-danger dropdown-toggle"
                                  data-toggle="dropdown"
                                  aria-haspopup="true"
                                  aria-expanded="false"
                                  style="
                                      background-color: #EBF1FB !important;
                                      border: none !important;
                                      border-radius: 5px !important;
                                      width: 60px;
                                      height: 37px;
                                      display: inline-flex;
                                      align-items: center;
                                      justify-content: space-between;
                                      color: #0061AF !important;
                                      padding: 0 8px;
                                      cursor: pointer;
                                    ">
                            <i class="fa fa-file-o"
                               style="
                                       font-size: 16px;
                                       color: #0061AF !important;
                                       margin-left: 5px;
                                     ">
                            </i>
                            <span style="
                                  display: inline-block;
                                  width: 0;
                                  height: 0;
                                  border-left: 4px solid transparent;
                                  border-right: 4px solid transparent;
                                  border-top: 4px solid #0061AF;
                                "></span>
                          </button>
                        <ul class="dropdown-menu">
                            <li><a href="index.php?route=extension/shipping/meest2/parcelList&token=<?php echo $token; ?>">Meest Cn List</a></li>
                        </ul>
                    </div>
                ]]>
            </add>
        </operation>
    </file>

</modification>

